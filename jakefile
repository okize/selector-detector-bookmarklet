var path = require('path'),
    fs = require('fs'),
    uglify = require('uglify-js'),
    jsBookmarklet = 'selector-detector-bookmarklet-wrapper.js',
    jsScript = 'selector-detector-bookmarklet-script.js',
    buildDir = './build',
    minfile = 'selector-detector-bookmarklet.min.js',
    template = 'index-tmpl.html',
    outfile = 'index.html',
    minified,
    result;

var error = function (err) {
  console.error(err);
};

desc('Create bookmarklet');
task('default', [], function () {

  fs.readFile(template, 'utf8', function (err, data) {

    if (err) { return error(err); }
    minified = uglify.minify(jsBookmarklet);
    result = data.replace('{{replaceMe}}', encodeURI(minified.code).toString());

    fs.writeFile(outfile, result, function (err) {

      if (err) { return error(err); }
      console.log('JS saved to index.html');

    });

  });

}, true);

desc('Minify script');
task('minify', [], function () {

  minified = uglify.minify(jsScript);

  fs.writeFile(path.join(buildDir, minfile), minified.code, function (err) {

    if (err) { return error(err); }
    console.log('JS minified');

  });


}, true);