var path = require('path'),
    fs = require('fs'),
    uglify = require('uglify-js'),
    script = 'selector-detector-bookmarklet.js', // should request this from github
    template = 'index-tmpl.html',
    outfile = 'index-new.html',
    minified,
    result;

var error = function (err) {
  console.error(err);
};

desc('Create bookmarklet');
task('default', [], function () {

  fs.readFile(template, 'utf8', function (err, data) {

    if (err) { return error(err); }
    minified = uglify.minify(script);
    result = data.replace('{{replaceMe}}', encodeURI(minified.code).toString());

    fs.writeFile(outfile, result, function (err) {

      if (err) { return error(err); }
      console.log('bookmarklet created in index.html');

    });

  });

}, true);